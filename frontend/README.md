# 租房协商对话前端界面

这个文件夹包含了用于展示租房协商系统对话内容的Streamlit前端界面。

## 📁 文件说明

### 主要文件
- `enhanced_negotiation_dashboard.py` - 功能完整的协商对话面板（推荐使用）
- `simple_chat_viewer.py` - 简化版对话查看器
- `streamlit_negotiation_dashboard.py` - 基础版对话面板
- `requirements.txt` - Python依赖包
- `start_dashboard.sh` - 启动脚本

## 🚀 快速开始

### 1. 安装依赖
```bash
cd /home/yushiran/Rental_Agent/frontend
pip install -r requirements.txt
```

### 2. 启动后端API服务
在另一个终端中运行：
```bash
cd /home/yushiran/Rental_Agent/backend
python -m app.api_service.main
```

### 3. 启动前端界面

#### 方法一：使用启动脚本（推荐）
```bash
./start_dashboard.sh
```

#### 方法二：手动启动
```bash
# 启动增强版面板
streamlit run enhanced_negotiation_dashboard.py --server.port=8501

# 或启动简化版查看器
streamlit run simple_chat_viewer.py --server.port=8502
```

### 4. 访问界面
- 增强版面板：http://localhost:8501
- 简化版查看器：http://localhost:8502

## 💡 功能特点

### 增强版面板 (`enhanced_negotiation_dashboard.py`)
- ✅ **实时协商监控** - 查看所有活跃的协商会话
- ✅ **双向对话测试** - 模拟租客或房东发送消息
- ✅ **自动刷新功能** - 可设置自动刷新间隔
- ✅ **美观的UI设计** - 现代化界面，支持响应式布局
- ✅ **统计信息展示** - 显示协商统计数据
- ✅ **消息模板** - 预设的快速消息模板
- ✅ **会话管理** - 启动新协商、模拟租客兴趣
- ✅ **状态筛选** - 按会话状态筛选显示
- ✅ **连接状态检查** - 实时检查API连接状态

### 简化版查看器 (`simple_chat_viewer.py`)
- ✅ **简洁界面** - 专注于查看对话内容
- ✅ **会话列表** - 清晰显示所有可用会话
- ✅ **对话测试** - 发送测试消息查看AI响应
- ✅ **快速模板** - 预设消息模板快速测试
- ✅ **对话记录** - 本地保存对话历史
- ✅ **会话详情** - 显示房产、租客、房东信息

## 🎯 使用场景

### 1. 开发测试
- 测试AI对话逻辑
- 验证消息发送功能
- 检查API响应速度

### 2. 演示展示
- 向客户展示系统功能
- 演示智能协商过程
- 展示对话质量

### 3. 系统监控
- 监控活跃协商会话
- 查看协商统计数据
- 实时了解系统状态

## 📋 使用步骤

### 基本使用流程
1. **启动服务** - 确保后端API正在运行
2. **创建会话** - 点击"启动协商"创建新的协商会话
3. **选择会话** - 从会话列表中选择要查看的协商
4. **查看对话** - 在对话区域查看历史消息
5. **发送消息** - 选择身份并发送测试消息
6. **查看响应** - 观察AI生成的响应内容

### 高级功能
- **自动刷新** - 启用自动刷新实时更新数据
- **状态筛选** - 按协商状态筛选会话
- **模拟兴趣** - 批量模拟租客表达兴趣
- **统计监控** - 查看详细的协商统计信息

## 🔧 配置说明

### API配置
默认API地址：`http://localhost:8000`

如需修改，请编辑文件中的 `API_BASE_URL` 变量。

### 端口配置
- 增强版面板：端口 8501
- 简化版查看器：端口 8502

## 🐛 常见问题

### 1. 无法连接到API
**问题**：界面显示"无法连接到API"
**解决**：
- 确保后端服务正在运行：`python -m app.api_service.main`
- 检查端口8000是否被占用
- 确认防火墙设置

### 2. 没有显示会话
**问题**：会话列表为空
**解决**：
- 点击"启动协商"创建新会话
- 确保数据库中有租客、房东、房产数据
- 检查后端日志是否有错误

### 3. 消息发送失败
**问题**：发送消息时出现错误
**解决**：
- 检查会话是否仍然活跃
- 确认AI服务正常运行
- 查看后端API日志

### 4. 界面显示异常
**问题**：Streamlit界面显示不正常
**解决**：
- 刷新浏览器页面
- 清除浏览器缓存
- 重启Streamlit服务

## 📝 开发说明

### 添加新功能
1. 在对应的Python文件中添加新的方法
2. 在Streamlit界面中添加相应的UI组件
3. 测试功能是否正常工作

### 修改样式
编辑文件中的CSS样式部分：
```python
st.markdown("""
<style>
/* 在这里添加自定义CSS */
</style>
""", unsafe_allow_html=True)
```

### 调试技巧
- 使用 `st.write()` 输出调试信息
- 检查 `st.session_state` 中的数据
- 使用浏览器开发者工具查看网络请求

## 📞 技术支持

如果遇到问题，请：
1. 检查后端API是否正常运行
2. 查看浏览器控制台是否有错误信息
3. 检查网络连接和端口设置
4. 参考上述常见问题解决方案

---

**注意**：使用前请确保后端API服务正在运行，否则前端界面无法正常工作。
